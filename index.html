<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>cpbl draft</title>
        <link rel="stylesheet" type="text/css" href="main.css" media="all" />
        <style type="text/css">
            #messages { padding: 0px; list-style-type: none;}
            #messages li { padding: 2px 0px; border-bottom: 1px solid #ccc; }
            #draft-form {display: none};
            #nicknames { width: 300px; float: right; }
        </style>
    </head>
    <body>
        <form id="set-nickname">
            <label for="nickname">Nickname:</label>
            <input type="text" id="nickname" />
            <input type="submit" />
        </form>
        <form id="draft-form">
            <label for="draft">Draft:</label>
            <input type="text" id="draft" />
            <input type="submit" />
        </form>
        <form id="create-form">
            <label for="create">Create new league:</label>
            <input type="text" id="create-name" />
            <input type="submit" />
        </form>
        <form id="join-form">
            <label for="join">Join:</label>
            <input type="text" id="join" />
            <input type="submit" />
        </form>
        <section>
            <ul id="nicknames"></ul>
        </section>
        <div id="right">
            <section>
                <ul id="messages"></ul>
            </section>
            <section>
                <ul id="players"></ul>
            </section>
        </div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            let socket = io('/real-draft');
            socket.on('connect', function(){
            jQuery(function ($) {
                let nickname = $('#nickname');
                let setNicknameForm = $('#set-nickname');
                let nicknamesList = $('nicknames ul');
                let draftPlayer = $('#draft');
                let draftForm = $('#draft-form');
                let joinLeague = $('#join');
                let joinForm = $('#join-form');
                let playersList = $('#players ul');
                let createName = $('#create-name');
                let createForm = $('#create-form');

                setNicknameForm.submit(function(event) {
                    event.preventDefault();
                    socket.emit('nickname', nickname.val(), function(data) {
                        if(data) {
                            setNicknameForm.hide();
                        } else {
                            setNicknameForm.prepend('<p>nickname already taken.</p>');
                        }
                    });
                });
                draftForm.submit(function(event) {
                    event.preventDefault();
                    socket.emit('draft', draftPlayer.val(), function(data) {
                        if(data) {
                            alert('Player drafted successfully');
                            //draftForm.hide();
                        }
                        else {
                            alert('player draft fail');
                        }
                    });
                });
                createForm.submit(function(event) {
                    event.preventDefault();
                    socket.emit('create', createName.val(), function(data, name) {
                        if(data) {
                            createForm.hide();
                            joinForm.hide();
                            alert(name);
                        } else {
                            alert('league name already exist');
                        }
                    });
                });
                joinForm.submit(function(event) {
                    event.preventDefault();
                    socket.emit('joinLeague', joinLeague.val(), function(data) {
                        if(data) {
                            createForm.hide();
                            joinForm.hide();
                        } else {
                            alert('league does not exist');
                        }
                    });
                });
                socket.on('disconnect', function() {
                    $('#messages').append('<li>Disconnected</li>');
                });
                socket.on('output', function(data) {
                    let html = '<tr><th>Name</th><th>Team</th><th>RBI</th><th>H</th><th>OBP</th><th>AVG</th><th>ERA</th><th>WHIP</th><th>W</th></tr>';;
                    for(let i = 0; i < data.length; i++) {
                        html += '<tr>';
                        html += '<th>' + data[i].name + '</th>';
                        html += '<th>' + data[i].team + '</th>';
                        html += '<th>' + data[i].RBI + '</th>';
                        html += '<th>' + data[i].H + '</th>';
                        html += '<th>' + data[i].OBP + '</th>';
                        html += '<th>' + data[i].AVG + '</th>';
                        html += '<th>' + data[i].ERA + '</th>';
                        html += '<th>' + data[i].WHIP + '</th>';
                        html += '<th>' + data[i].W + '</th>';
                        html += '</tr>';
                    }
                    $('#players').empty().append(html);
                    draftForm.show();
                });

                socket.on('nicknames', function(data) {
                    let html = '';
                    for(let i = 0; i < data.length; i++) {
                        html += '<li>' + data[i] + '</li>';
                    }
                    $('#nicknames').empty().append(html);
                    //$('#nicknames').empty().append($('<li></li>').text(html));
                });
                socket.on('message', function(message) {
                    $('#messages').append($('<li></li>').text(message));
                });
                socket.on('end', function(message) {
                    $('#messages').append($('<li></li>').text(message));
                    draftForm.hide();
                })
            });
        });
        </script>
    </body>
</html>